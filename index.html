<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vocab List</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    h1 { color: #333; }
    table { margin: 20px auto; border-collapse: collapse; width: 80%; }
    th, td { border: 1px solid #ccc; padding: 10px; }
    th { background: #f4f4f4; }
    button { margin: 5px; padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; }
    .speak-btn { background: #4CAF50; color: white; }
    .speak-all-btn { background: #2196F3; color: white; }
    .pause-btn { background: #FF9800; color: white; }
    .resume-btn { background: #9C27B0; color: white; }
    .highlight { background: yellow; }
  </style>
</head>
<body>

  <h1>Vocab List</h1>
  <div>
    <button id="speakAll" class="speak-all-btn">üîä Speak All</button>
    <button id="pauseAll" class="pause-btn">‚è∏ Pause</button>
    <button id="resumeAll" class="resume-btn">‚ñ∂ Resume</button>
  </div>
  <table id="vocabTable">
    <thead>
      <tr><th>French</th><th>English</th><th>Action</th></tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
const sheetId = "1whwTQDubf_im8SBxQGvI3diuAdWKwo5CYZwmpDNobEI";
const gid = "0"; // Sheet1
const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&gid=${gid}`;

let vocab = [];
let currentIndex = 0;
let isPaused = false;

// Fetch vocab
fetch(url)
  .then(res => res.text())
  .then(data => {
    const json = JSON.parse(data.substr(47).slice(0, -2));
    vocab = json.table.rows.map(r => ({
      french: r.c[0]?.v || "",
      english: r.c[1]?.v || ""
    }));
    renderTable(vocab);
  });

function renderTable(vocab) {
  const tbody = document.querySelector("#vocabTable tbody");
  tbody.innerHTML = "";
  vocab.forEach((row, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${row.french}</td>
      <td>${row.english}</td>
      <td><button class="speak-btn" onclick="speakWord('${row.french}')">Speak</button></td>
    `;
    tbody.appendChild(tr);
  });
}

// Speak single word (only French)
function speakWord(text) {
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "fr-FR";
  speechSynthesis.speak(utter);
}

// Speak All (French + English, 1 sec pause, highlight row)
async function speakAll() {
  currentIndex = 0;
  isPaused = false;
  await loopSpeak();
}

async function loopSpeak() {
  const rows = document.querySelectorAll("#vocabTable tbody tr");
  while (currentIndex < vocab.length && !isPaused) {
    let row = vocab[currentIndex];

    rows.forEach(r => r.classList.remove("highlight"));
    rows[currentIndex].classList.add("highlight");

    await speakWithPromise(row.french, "fr-FR");
    await delay(1000);
    await speakWithPromise(row.english, "en-US");
    await delay(1000);

    currentIndex++;
  }
}

function speakWithPromise(text, lang) {
  return new Promise(resolve => {
    let utter = new SpeechSynthesisUtterance(text);
    utter.lang = lang;
    utter.onend = resolve;
    speechSynthesis.speak(utter);
  });
}

function delay(ms) {
  return new Promise(res => setTimeout(res, ms));
}

// Pause
function pauseAll() {
  isPaused = true;
  speechSynthesis.pause();
}

// Resume
function resumeAll() {
  if (isPaused) {
    isPaused = false;
    speechSynthesis.resume();
    loopSpeak();
  }
}

// Event listeners
document.getElementById("speakAll").addEventListener("click", speakAll);
document.getElementById("pauseAll").addEventListener("click", pauseAll);
document.getElementById("resumeAll").addEventListener("click", resumeAll);

</script>
</body>
</html>
