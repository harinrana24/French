<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vocab List</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    h1 { color: darkblue; }
    table { margin: auto; border-collapse: collapse; width: 70%; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    tr.highlight { background-color: #ffff99; }
    button { margin: 5px; padding: 5px 10px; }
    .nav { margin-bottom: 20px; }
  </style>
</head>
<body>
  <h1>Vocab List</h1>

  <div class="nav">
    <button onclick="loadSheet('Sheet1')">Vocab List</button>
    <button onclick="loadSheet('Sheet2')">Common Things</button>
  </div>

  <div>
    <button onclick="speakAll()">‚ñ∂ Speak All</button>
    <button onclick="pauseSpeaking()">‚è∏ Pause</button>
    <button onclick="resumeSpeaking()">‚ñ∂ Resume</button>
    <button onclick="stopSpeaking()">‚èπ Stop</button>
  </div>

  <table id="vocabTable">
    <thead>
      <tr><th>French</th><th>English</th><th>Speak</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const sheetID = "1whwTQDubf_im8SBxQGvI3diuAdWKwo5CYZwmpDNobEI";
    let currentUtterance = null;
    let synth = window.speechSynthesis;

    async function loadSheet(sheetName) {
      const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:csv&sheet=${sheetName}`;
      const response = await fetch(url);
      const text = await response.text();

      const rows = text.trim().split("\n").map(r => r.split(","));
      const tbody = document.querySelector("#vocabTable tbody");
      tbody.innerHTML = "";

      rows.forEach(([french, english]) => {
        let row = document.createElement("tr");
        row.innerHTML = `
          <td>${french}</td>
          <td>${english}</td>
          <td><button onclick="speakWord('${french}')">üîä</button></td>
        `;
        tbody.appendChild(row);
      });
    }

    function speakWord(word) {
      stopSpeaking();
      let utter = new SpeechSynthesisUtterance(word);
      utter.lang = "fr-FR"; 
      synth.speak(utter);
    }

    async function speakAll() {
      stopSpeaking();
      const rows = [...document.querySelectorAll("#vocabTable tbody tr")];
      let index = 0;

      function speakNext() {
        if (index >= rows.length) return;

        rows.forEach(r => r.classList.remove("highlight"));
        rows[index].classList.add("highlight");

        let french = rows[index].cells[0].innerText;
        let english = rows[index].cells[1].innerText;

        let utterFrench = new SpeechSynthesisUtterance(french);
        utterFrench.lang = "fr-FR";

        let utterEnglish = new SpeechSynthesisUtterance(english);
        utterEnglish.lang = "en-US";

        utterEnglish.onend = () => {
          index++;
          setTimeout(speakNext, 1000); // 1 sec pause
        };

        synth.speak(utterFrench);
        synth.speak(utterEnglish);
      }
      speakNext();
    }

    function pauseSpeaking() {
      if (synth.speaking && !synth.paused) synth.pause();
    }

    function resumeSpeaking() {
      if (synth.paused) synth.resume();
    }

    function stopSpeaking() {
      synth.cancel();
      document.querySelectorAll("#vocabTable tr").forEach(r => r.classList.remove("highlight"));
    }

    // Load Sheet1 first
    loadSheet("Sheet1");
  </script>
</body>
</html>
